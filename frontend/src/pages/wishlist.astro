---
import Layout from "../layouts/Layout.astro";
import SiteTopBar from "../components/SiteTopBar.astro";
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";
import Breadcrumbs from "../components/Breadcrumbs.astro";
import Icons from "../components/Icons.astro";
import ProductCard from "../components/ProductCard.astro";
import { fetchHome } from "../lib/api";
import type { HomePayload } from "../lib/api";

const emptyHome: HomePayload = {
	categories: [],
	bestSelling: [],
	explore: [],
	newArrival: [],
	themeCategoryId: "AT",
};

const data: HomePayload = await fetchHome().catch(() => emptyHome);
const justForYou = (data.bestSelling.length ? data.bestSelling : data.explore).slice(0, 4);
---

<Layout title="Wishlist | Exclusive">
	<div id="top" class="bg-white text-zinc-900">
		<SiteTopBar />
		<SiteHeader active="none" accountName="Mirza" />

		<main class="mx-auto max-w-6xl px-4">
			<section class="py-8">
				<Breadcrumbs items={[{ label: "Home", href: "/" }, { label: "Wishlist" }]} />

				<div class="mt-10 flex items-center justify-between">
					<p class="text-sm font-semibold">Wishlist (<span data-wishlist-count>0</span>)</p>
					<button type="button" class="rounded border border-zinc-300 px-6 py-2.5 text-sm font-semibold hover:bg-zinc-50" data-move-all>
						Move All To Bag
					</button>
				</div>

				<div class="mt-8">
					<p class="hidden rounded bg-white p-6 text-center text-sm text-zinc-600 ring-1 ring-zinc-200" data-wishlist-empty>
						Wishlist kamu masih kosong.
					</p>
					<div class="grid grid-cols-2 gap-4 md:grid-cols-4" data-wishlist-grid></div>
				</div>

				<div class="mt-14 flex items-center justify-between">
					<div class="flex items-center gap-2">
						<span class="inline-block h-6 w-3 rounded bg-red-500"></span>
						<p class="text-xs font-semibold text-red-500">Just For You</p>
					</div>
					<a href="/products" class="rounded border border-zinc-300 px-6 py-2.5 text-sm font-semibold hover:bg-zinc-50">See All</a>
				</div>

				<div class="mt-6 grid grid-cols-2 gap-4 md:grid-cols-4">
					{justForYou.map((p, idx) => (
						<div class="relative">
							{idx === 0 ? (
								<span class="absolute left-3 top-3 z-10 rounded bg-red-500 px-2 py-1 text-[11px] font-semibold text-white">-30%</span>
							) : idx === 2 ? (
								<span class="absolute left-3 top-3 z-10 rounded bg-green-500 px-2 py-1 text-[11px] font-semibold text-white">NEW</span>
							) : null}
							<ProductCard product={p} />
						</div>
					))}
				</div>
			</section>
		</main>

		<SiteFooter />

		<script is:inline>
			const grid = document.querySelector('[data-wishlist-grid]');
			const empty = document.querySelector('[data-wishlist-empty]');
			const countEl = document.querySelector('[data-wishlist-count]');
			const moveAll = document.querySelector('[data-move-all]');
			if (grid instanceof HTMLElement && empty instanceof HTMLElement) {
				const render = () =>
					window.ExclusiveStore?.renderWishlistGrid?.({
						grid,
						empty,
						onCount: (n) => {
							if (countEl) countEl.textContent = String(n);
						},
					});
				render();
				window.addEventListener('store:wishlist', render);
				moveAll?.addEventListener('click', () => {
					window.ExclusiveStore?.moveWishlistToCart?.();
					render();
				});
			}
		</script>
	</div>
</Layout>
